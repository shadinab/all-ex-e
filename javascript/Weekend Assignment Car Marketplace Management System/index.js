const agencies = [
  {
    agencyName: "Best Deal",
    cash: 1245000,
    credit: 200000,
    agencyId: "Plyq5M5AZ",

    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "3",
            year: 2015,
            price: 137000,
            carNumber: "AZJZ4",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "X6",
            year: 2020,
            price: 966500,
            carNumber: "S6DL1",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2020,
            price: 336300,
            carNumber: "6rvXw",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Hilux",
            year: 2005,
            price: 35005,
            carNumber: "MWXBG",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Corolla",
            year: 2020,
            price: 111900,
            carNumber: "hCzl-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Focus",
            year: 2020,
            price: 98200,
            carNumber: "kN3HP",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Focus",
            year: 2005,
            price: 6502,
            carNumber: "LJTCs",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Romeo Julia",
            year: 2020,
            price: 275406,
            carNumber: "2kjy7",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Romeo Stelvio",
            year: 2019,
            price: 215403,
            carNumber: "7A5b-",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Traverse",
            year: 2020,
            price: 201102,
            carNumber: "QwBOT",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Impala",
            year: 2019,
            price: 165041,
            carNumber: "2v4jt",
            ownerId: "Plyq5M5AZ",
          },
          {
            name: "Malibu",
            year: 2017,
            price: 75405,
            carNumber: "O4_Jv",
            ownerId: "Plyq5M5AZ",
          },
        ],
      },
    ],
  },
  {
    agencyName: "CarMax",
    cash: 968541,
    credit: 500000,
    agencyId: "26_IPfHU1",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X5",
            year: 2015,
            price: 218000,
            carNumber: "4Ixb0",
            ownerId: "26_IPfHU1",
          },
          {
            name: "X6",
            year: 2014,
            price: 97100,
            carNumber: "kAnv-",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Z4",
            year: 2019,
            price: 296900,
            carNumber: "ISMdU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "3",
            year: 2010,
            price: 75100,
            carNumber: "9DJPw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Land Cruiser",
            year: 2005,
            price: 80540,
            carNumber: "Kt-pW",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Corolla",
            year: 2019,
            price: 109100,
            carNumber: "YiYdI",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Hilux",
            year: 2019,
            price: 204000,
            carNumber: "DRmNw",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "F250",
            year: 2020,
            price: 198500,
            carNumber: "g4Wfp",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Explorer",
            year: 2020,
            price: 265200,
            carNumber: "iNT8Q",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Alpha romeo",
        models: [
          {
            name: "Spider",
            year: 2011,
            price: 75405,
            carNumber: "6t7QU",
            ownerId: "26_IPfHU1",
          },
          {
            name: "166",
            year: 2002,
            price: 12400,
            carNumber: "XMqpn",
            ownerId: "26_IPfHU1",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2016,
            price: 65042,
            carNumber: "vbeAo",
            ownerId: "26_IPfHU1",
          },
          {
            name: "Savannah",
            year: 2016,
            price: 76505,
            carNumber: "WelWa",
            ownerId: "26_IPfHU1",
          },
        ],
      },
    ],
  },
  {
    agencyName: "The Auto World",
    cash: 687450,
    credit: 200000,
    agencyId: "gNHjNFL12",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "X6",
            year: 2018,
            price: 548100,
            carNumber: "EMW_7",
            ownerId: "gNHjNFL12",
          },
          {
            name: "3",
            year: 2017,
            price: 178000,
            carNumber: "XlnB4",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2017,
            price: 101542,
            carNumber: "-RQgN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Highlander",
            year: 2017,
            price: 202540,
            carNumber: "AZJZ4",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 1996,
            price: 5420,
            carNumber: "kHE8f",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Corolla",
            year: 2012,
            price: 40570,
            carNumber: "p2qEi",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Ford",
        models: [
          {
            name: "Explorer",
            year: 2014,
            price: 127502,
            carNumber: "Ty1zN",
            ownerId: "gNHjNFL12",
          },
          {
            name: "F350",
            year: 2012,
            price: 54250,
            carNumber: "z03H2",
            ownerId: "gNHjNFL12",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Savannah",
            year: 2010,
            price: 36504,
            carNumber: "RXFZe",
            ownerId: "gNHjNFL12",
          },
          {
            name: "Malibu",
            year: 2009,
            price: 19585,
            carNumber: "K5IsM",
            ownerId: "gNHjNFL12",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Car Werks",
    cash: 302502,
    credit: 150000,
    agencyId: "9KeaYbRLP",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "8",
            year: 2020,
            price: 942500,
            carNumber: "4IUMz",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X6",
            year: 2010,
            price: 129000,
            carNumber: "Vw0fV",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "X3",
            year: 2019,
            price: 358100,
            carNumber: "ufN54",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2020,
            price: 389100,
            carNumber: "F127X",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "3",
            year: 2002,
            price: 18400,
            carNumber: "ueZUp",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2011,
            price: 38520,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Land Cruiser",
            year: 2019,
            price: 290040,
            carNumber: "AZJZ4",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2020,
            price: 215700,
            carNumber: "xig8N",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Hilux",
            year: 2015,
            price: 178506,
            carNumber: "ghTiQ",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Corolla",
            year: 2002,
            price: 8504,
            carNumber: "Mvw8T",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
      {
        brand: "Chevrolet",
        models: [
          {
            name: "Impala",
            year: 2005,
            price: 9320,
            carNumber: "BZpkt",
            ownerId: "9KeaYbRLP",
          },
          {
            name: "Malibu",
            year: 2002,
            price: 4502,
            carNumber: "KqKV_",
            ownerId: "9KeaYbRLP",
          },
        ],
      },
    ],
  },
  {
    agencyName: "Carsova",
    cash: 72450,
    credit: 50000,
    agencyId: "oqQmsZoUo",
    cars: [
      {
        brand: "bmw",
        models: [
          {
            name: "7",
            year: 1999,
            price: 24700,
            carNumber: "sZrjp",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "3",
            year: 2008,
            price: 54000,
            carNumber: "da88K",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
      {
        brand: "toyota",
        models: [
          {
            name: "Prius",
            year: 2019,
            price: 124050,
            carNumber: "ZfbqH",
            ownerId: "oqQmsZoUo",
          },
          {
            name: "Hilux",
            year: 1996,
            price: 11540,
            carNumber: "AZJZ4",
            ownerId: "oqQmsZoUo",
          },
        ],
      },
    ],
  },
]

// customers---------------------------------------------------------------------------------------------------------------

const customers = [
  {
    name: "Lilah Goulding",
    id: "BGzHhjnE8",
    cars: [
      {
        name: "Corolla",
        year: 2013,
        price: 40570,
        carNumber: "16da1",
        ownerId: "BGzHhjnE8",
      },
    ],
    cash: 35000,
  },
  {
    name: "Ravi Murillo",
    id: "2RprZ1dbL",
    cars: [
      {
        name: "M5",
        year: 2019,
        price: 578054,
        carNumber: "WIh0U",
        ownerId: "2RprZ1dbL",
      },
      {
        name: "Spider",
        year: 2012,
        price: 81520,
        carNumber: "RLS4q",
        ownerId: "2RprZ1dbL",
      },
    ],
    cash: 278542,
  },
  {
    name: "Aleksander Carr",
    id: "pAuFtn_WA",
    cars: [
      {
        name: "Highlander",
        year: 2018,
        price: 214503,
        carNumber: "2WU_y",
        ownerId: "pAuFtn_WA",
      },
    ],
    cash: 125402,
  },
  {
    name: "Lana Edge",
    id: "cnTobUDy6",
    cars: [
      {
        name: "F250",
        year: 2020,
        price: 198500,
        carNumber: "Xxcy_",
        ownerId: "cnTobUDy6",
      },
      {
        name: "Hilux",
        year: 2005,
        price: 35005,
        carNumber: "VSCUj",
        ownerId: "cnTobUDy6",
      },
    ],
    cash: 7000,
  },
  {
    name: "Nikita Philip",
    id: "5x2tMcX4R",
    cars: [
      {
        name: "Impala",
        year: 2016,
        price: 65042,
        carNumber: "LKInp",
        ownerId: "5x2tMcX4R",
      },
    ],
    cash: 40541,
  },
  {
    name: "Bob Steel",
    id: "Wm6BkA1F0",
    cars: [],
    cash: 15732,
  },
  {
    name: "Will Reyes",
    id: "FQvNsEwLZ",
    cars: [
      { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
      {
        name: "Land Cruiser",
        year: 2020,
        price: 336300,
        carNumber: "vaJvd",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Romeo Julia",
        year: 2020,
        price: 275406,
        carNumber: "qLoYR",
        ownerId: "FQvNsEwLZ",
      },
      {
        name: "Explorer",
        year: 2020,
        price: 265200,
        carNumber: "tlGRq",
        ownerId: "FQvNsEwLZ",
      },
    ],
    cash: 1547242,
  },
]

// taxesAuthority---------------------------------------------------------------------------------------------------------


const taxesAuthority = {
  totalTaxesPaid: 0,
  sumOfAllTransactions: 0,
  numberOfTransactions: 0,
};


// 1. Agency Operations:--------------------------------------------------------------------------------------------



// getAgencyByName
// @param {string} - name
// @return {Object|null} - agency object or null if not found
getAgencyByName = (name) => {
  const foundAgency = agencies.find((agency) => agency.agencyName === name);
  return foundAgency || null;
};

// getAgencyById
// @param {string} - id
// @return {Object|null} - agency object or null if not found
getAgencyById = (id) => {
  const foundAgency = agencies.find((agency) => agency.agencyId === id);
  return foundAgency || null;
};

const agencyByName = getAgencyByName("CarMax");
const agencyById = getAgencyById("Plyq5M5AZ");
console.log(agencyByName); // Returns the agency object with the name "Best Deal"
console.log(agencyById);   // Returns the agency object with the ID "Plyq5M5AZ"


// Retrieve all agencies' names.--------------------------------------------------------------------------------------


// getAllAgenciesNames
// @return {string[]} - agenciesNameArr - Array of all agencies' names
getAllAgenciesNames = function () {
  const agencyNames = agencies.map((agency) => agency.agencyName);
  return agencyNames;
};

// Usage example
const allAgencyNames = getAllAgenciesNames();
console.log(allAgencyNames);


// // Add a new car to an agency's inventory.------------------------------------------------------------------------------


// setNewCarToAgency
// @param {string} - id of agency
// @param {object} - carObject
setNewCarToAgency = function (agencyId, carObject) {
  const agencyIndex = agencies.findIndex((agency) => agency.agencyId === agencyId);

  if (agencyIndex !== -1) {
    agencies[agencyIndex].cars.push(carObject);
    return true;
  } else {
    return false; // Agency with the given ID not found
  }
};

// Usage example
const newCar = {
  brand: "Toyota",
  models: [
    {
      name: "Camry",
      year: 2022,
      price: 30000,
      carNumber: "ABC123",
      ownerId: null, // Since it's a new car, the ownerId is set to null initially
    },
  ],
};

const agencyId = "Plyq5M5AZ"; // Example agency ID, you should provide the correct ID here
const isCarAdded = setNewCarToAgency(agencyId, newCar);

if (isCarAdded) {
  console.log("New car added to the agency's inventory!");
} else {
  console.log("Agency with the given ID not found!");
}

// // Remove a car from an agency's inventory.----------------------------------------------------------------------------


// deleteCarFromAgency
// @param {string} - id of agency
// @param {string} - Car id
function removeCarFromInventory(agencyName, carNumber) {
  // Step 1: Find the agency
  const agency = agencies.find((agency) => agency.agencyName === agencyName);

  if (agency) {
    // Step 2: Find the car within the agency's cars array
    const carIndex = agency.cars.findIndex((car) => car.models.some((model) => model.carNumber === carNumber));

    if (carIndex !== -1) {
      // Step 3: Remove the car from the cars array
      agency.cars.splice(carIndex, 1);
      console.log(`Car with carNumber ${carNumber} has been removed from ${agencyName}'s inventory.`);
    } else {
      console.log(`Car with carNumber ${carNumber} not found in ${agencyName}'s inventory.`);
    }
  } else {
    console.log(`Agency with name ${agencyName} not found.`);
  }
}

// Usage example:
removeCarFromInventory("Best Deal", "MWXBG");



// // Change the cash or credit of an agency.---------------------------------------------------------------------------

// decrementOrIncrementCashOfAgency
// @param {string} - agencyId
// @param {number} - amount - negative or positive amount
// @return {number} - agencyCash
decrementOrIncrementCashOfAgency = function (agencyId, amount) {
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (agency) {
    agency.cash += amount;
    return agency.cash;
  } else {
    return null; // Agency with the given ID not found
  }
};

// decrementOrIncrementCreditOfAgency
// @param {string} - agencyId
// @param {number} - amount - negative or positive amount
// @return {number} - agencyCredit
decrementOrIncrementCreditOfAgency = function (agencyId, amount) {
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (agency) {
    agency.credit += amount;
    return agency.credit;
  } else {
    return null; // Agency with the given ID not found
  }
};

// Usage examples
const agencyId1 = "Plyq5M5AZ"; // Example agency ID, you should provide the correct ID here
const cashChangeAmount = 50000; // Example amount to change the cash, you can provide a negative value to decrement
const creditChangeAmount = -200000; // Example amount to change the credit, you can provide a positive value to increment

const newCash = decrementOrIncrementCashOfAgency(agencyId1, cashChangeAmount);
const newCredit = decrementOrIncrementCreditOfAgency(agencyId1, creditChangeAmount);

if (newCash !== null) {
  console.log(`New cash balance of agency with ID ${agencyId1}: ${newCash}`);
} else {
  console.log("Agency with the given ID not found!");
}

if (newCredit !== null) {
  console.log(`New credit balance of agency with ID ${agencyId1}: ${newCredit}`);
} else {
  console.log("Agency with the given ID not found!");
}


// // Update the price of a specific car in an agency (Method: updateCarPrice ).----------------------------------------------
function updateCarPrice(agencyName, carBrand, carModelName, newPrice) {
  // Find the agency with the given name
  const agency = agencies.find((agency) => agency.agencyName === agencyName);

  if (!agency) {
    console.log("Agency not found.");
    return;
  }

  // Find the car with the given brand and model name in the agency's cars
  const carToUpdate = agency.cars.find(
    (car) => car.brand === carBrand && car.models.some((model) => model.name === carModelName)
  );

  if (!carToUpdate) {
    console.log("Car not found in the agency.");
    return;
  }


  // Find the model with the given name and update its price
  const modelToUpdate = carToUpdate.models.find((model) => model.name === carModelName);
  modelToUpdate.price = newPrice;
  console.log(`Price updated successfully: ${agencyName}, ${carBrand}, ${carModelName}, New Price: ${newPrice}`);
}

// Example usage:
updateCarPrice("CarMax", "bmw", "X5", 225000); // Update the price of the bmw X5 to 225,000


// // Calculate and return the total revenue for a specific agency (Method:------------------------------------------------

// Calculate total revenue for a specific agency
// @param {string} - agencyId
// @return {number} - total revenue for the agency
function getTotalAgencyRevenue(agencies, agencyId) {
  // Find the agency with the specified agencyId
  const agency = agencies.find((agency) => agency.agencyId === agencyId);

  if (!agency) {
    // Return 0 if the agency with the given ID is not found
    return 0;
  }

  // Calculate the total revenue for the agency
  let totalRevenue = 0;

  agency.cars.forEach((car) => {
    car.models.forEach((model) => {
      totalRevenue += model.price;
    });
  });

  return totalRevenue;
}


const agencyIdToCheck = "Plyq5M5AZ";
const totalRevenueForAgency = getTotalAgencyRevenue(agencies, agencyIdToCheck);
console.log("Total Revenue for Agency:", totalRevenueForAgency);


// // Transfer a car from one agency to another (Method: transferCarBetweenAgencies------------------------------------------


function transferCarBetweenAgencies(carName, sourceAgencyName, destinationAgencyName) {
  // Find the source agency and destination agency in the 'agencies' array
  const sourceAgency = agencies.find((agency) => agency.agencyName === sourceAgencyName);
  const destinationAgency = agencies.find((agency) => agency.agencyName === destinationAgencyName);

  // If either agency is not found, or the car name is not found in the source agency, return with an error message
  if (!sourceAgency || !destinationAgency) {
    console.log("Source agency or destination agency not found.");
    return;
  }

  const carToTransfer = sourceAgency.cars.find((car) => {
    const foundModel = car.models.find((model) => model.name === carName);
    return foundModel;
  });
  
      // If the car with the given name is not found in the source agency, return with an error message
  if (!carToTransfer) {
    console.log(`Car with name "${carName}" not found in ${sourceAgencyName}.`);
    return;
  }

  // Remove the car from the source agency
  const sourceCarIndex = sourceAgency.cars.findIndex((car) => car === carToTransfer);
  sourceAgency.cars.splice(sourceCarIndex, 1);

  // Update the ownerId of the car to the destination agency's ID
  carToTransfer.models.forEach((model) => {
    model.ownerId = destinationAgency.agencyId;
  });

  // Add the car to the destination agency
  destinationAgency.cars.push(carToTransfer);

  console.log(`Car "${carName}" transferred from ${sourceAgencyName} to ${destinationAgencyName}.`);
}

// Example usage:
transferCarBetweenAgencies("X6", "Best Deal", "CarMax");


// // 2. Customer Operations:
// // Search for a customer by their name or ID.--------------------------------------------------------------------------

// Search for a customer by their name or ID
// @param {string} - nameOrId
// @return {Object|null} - The customer object if found, null otherwise
const searchCustomer = function (nameOrId) {
  // Check if the search parameter is an ID (exact match)
  const customerById = customers.find((customer) => customer.id === nameOrId);

  // Check if the search parameter is a name (case-insensitive)
  const customerByName = customers.find((customer) => customer.name.toLowerCase() === nameOrId.toLowerCase());
  // Return the customer object if found, otherwise return null
  return customerById || customerByName || null;
};

// Usage example
const searchNameOrId = "BGzHhjnE8"; // Example name or ID, you should provide the correct name or ID here

const foundCustomer = searchCustomer(searchNameOrId);

if (foundCustomer) {
  console.log("Customer found:", foundCustomer);
} else {
  console.log("Customer not found.");
}


// // Retrieve all customers' names.----------------------------------------------------------------------------------

// Retrieve all customers' names
// // @return {string[]} - Array of all customers' names
const getAllCustomersNames = function () {
  const customerNames = customers.map((customer) => customer.name);
  return customerNames;
};

// Usage example
const allCustomersNames = getAllCustomersNames();
console.log(allCustomersNames);

// // Change the cash of a customer.-------------------------------------------------------------------------------------



// Change the cash of a customer
// @param {string} customerId - The ID of the customer
// @param {number} newCash - The new cash amount for the customer
// @return {boolean} - Returns true if the customer's cash was successfully updated, otherwise false
const changeCustomerCash = function (customerId, newCash) {
  const customer = customers.find((customer) => customer.id === customerId);

  if (customer) {
    customer.cash = newCash;
    return true;
  }
  return false;

};

// Usage example
const customerId = "BGzHhjnE8"; // Replace with the ID of the customer you want to update
const newCashAmount = 40000;   // Replace with the new cash amount you want to set
const isCashChanged = changeCustomerCash(customerId, newCashAmount);

if (isCashChanged) {
  console.log("Customer's cash was successfully updated.");
} else {
  console.log("Customer with the provided ID was not found.");
}

// // Calculate the total value of all cars owned by a specific customer (Method:-----------------------------------------------
// // getCustomerTotalCarValue ).

// Calculate the total value of all cars owned by a specific customer
// // @param {string} customerId - The ID of the customer
// // @return {number} - The total value of all cars owned by the customer
const getCustomerTotalCarValue = function (customerId) {
  const customer = customers.find((customer) => customer.id === customerId);
  if (customer) {
    return customer.cars.reduce((totalValue, car) => totalValue + car.price, 0);
  }
  return 0; // Return 0 if the customer with the provided ID is not found
};

// Usage example
const customerId1 = "2RprZ1dbL"; // Replace with the ID of the customer you want to calculate the total value of cars
const totalCarValue = getCustomerTotalCarValue(customerId1);
console.log(`Total value of all cars owned by the customer: $${totalCarValue}`);


// // 3--- Car Operations:------------------------------------------------------------------------------------------------
// // Retrieve all cars available for purchase.
// Retrieve all cars available for purchase
// @return {object[]} - An array of all cars available for purchase
const getAllCarsToBuy = function () {
  const allCarsToBuy = [];

  agencies.forEach((agency) => {
    agency.cars.forEach((carData) => {
      carData.models.forEach((carModel) => {
        allCarsToBuy.push({
          brand: carData.brand,
          name: carModel.name,
          year: carModel.year,
          price: carModel.price,
          carNumber: carModel.carNumber,
          ownerId: carModel.ownerId,
        });
      });
    });
  });

  return allCarsToBuy;
};

// // Usage example
// const allAvailableCars = getAllCarsToBuy();
// console.log(allAvailableCars);

// // Search for cars based on certain criteria. The search parameters should include the-------------------------------------------------------
// // production year, price, and optionally, the brand of the car

function searchCarsByCriteria(agencies, productionYear, maxPrice, brand) {
  const matchingCars = [];

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (
          model.year === productionYear &&
          model.price <= maxPrice &&
          car.brand.toLowerCase() === brand.toLowerCase()
        ) {
          matchingCars.push({
            agencyName: agency.agencyName,
            carBrand: brand,
            carModel: model.name,
            carYear: model.year,
            carPrice: model.price,
          });
        }
      }
    }
  }
  return matchingCars;
}

// Example usage:
const matchingCars = searchCarsByCriteria(agencies, 2019, 150000, "Toyota");
console.log(matchingCars);



// // Return the most expensive car available for sale (Method: getMostExpensiveCar ).----------------------------------

// Return the most expensive car available for sale
// @param {object[]} - carArray - Array of cars to search from
// @return {object|null} - The most expensive car object or null if no cars are available
function getMostExpensiveCar(agencies) {
  let mostExpensiveCar = null;
  let maxPrice = 0;

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (model.price > maxPrice) {
          maxPrice = model.price;
          mostExpensiveCar = model;
        }
      }
    }
  }

  return mostExpensiveCar;
}

// Usage example:
const mostExpensiveCar = getMostExpensiveCar(agencies);
console.log(mostExpensiveCar);


// // Return the cheapest car available for sale (Method: getCheapestCar ).------------------------------------------------
function getCheapestCar(agencies) {
  let cheapestCar = null;
  let minPrice = Number.MAX_VALUE;

  for (const agency of agencies) {
    for (const car of agency.cars) {
      for (const model of car.models) {
        if (model.price < minPrice) {
          minPrice = model.price;
          cheapestCar = model;
        }
      }
    }
  }

  return cheapestCar;
}

// Usage example:
const cheapestCar = getCheapestCar(agencies);
console.log(cheapestCar);


// // 4. Car Purchase Operations:-------------------------------------------------------------------------------------
// Check the availability of the car at the agency.
function sellCar(customerId, carNumber, agencyId) {
  // Find the customer and the agency in the provided data
  const customer = customers.find((c) => c.id === customerId);
  const agency = agencies.find((a) => a.agencyId === agencyId);

  if (!customer || !agency) {
    console.log("Customer or agency not found.");
    return;
  }

  // Find the car to be sold in the agency's inventory
  let carToSell = null;
  let carModelIndex = -1;
  let carBrandIndex = -1;

  for (let i = 0; i < agency.cars.length; i++) {
    const brand = agency.cars[i];
    const modelIndex = brand.models.findIndex((model) => model.carNumber === carNumber);

    if (modelIndex !== -1) {
      carBrandIndex = i;
      carModelIndex = modelIndex;
      carToSell = brand.models[modelIndex];
      break;
    }
  }

  if (!carToSell) {
    console.log("Car not found at the agency.");
    return;
  }

  // Check if the customer has enough cash to purchase the car
  if (customer.cash < carToSell.price) {
    console.log("Customer does not have enough cash to purchase the car.");
    return;
  }

  // Update the cash and credit for both the agency and the customer
  customer.cash -= carToSell.price;
  agency.cash += carToSell.price;

  // Remove the car from the agency's inventory
  agency.cars[carBrandIndex].models.splice(carModelIndex, 1);

  console.log(`Car with carNumber "${carNumber}" has been sold to ${customer.name}.`);
}

// Example usage:
const customerId2 = "FQvNsEwLZ"; // Customer ID
const carNumber = "6rvXw"; // Car Number of the car to be sold
const agencyId2 = "Plyq5M5AZ"; // Agency ID

sellCar(customerId2, carNumber, agencyId2);


// Calculate and return the total revenue of the entire market (Method:-----------------------------------------------
// getTotalMarketRevenue
function getTotalMarketRevenue() {
  let totalRevenue = 0;

  for (const agency of agencies) {
    for (const carBrandData of agency.cars) {
      for (const model of carBrandData.models) {
        totalRevenue += model.price;
      }
    }
  }

  return totalRevenue;
}

// Example usage:
const totalMarketRevenue = getTotalMarketRevenue();
console.log("Total market revenue: $" + totalMarketRevenue);
